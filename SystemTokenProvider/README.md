# Микросервис SystemTokenProvider 

## Цель

Необходимо дать возможность микросервисам использовать системные токены вместо токенов авторизации.

## Описание

Системные токены хранятся в БД, и к их созданию нет API.

### Сценарий 1: Проверка наличия системного токена

Вызывается метод GET /sec/st/checkSystemToken, на вход передается:

- systemToken: системный токен

Бекенд обращается к таблице systemToken (база данных), проверяет наличие системного токена из шага 1.a в таблице.

- Если в таблице не найден токен - сценарий завершается ошибкой TOKEN_NOT_FOUND.
- Если в таблице найден токен - сценарий продолжается.

Бекенд формирует ответ:

- status: success или error

  Если ошибка отсутствует:
  
  - system: система потребитель из таблицы
  - startDate: дата начала из таблицы
  - endDate: дата окончания из таблицы
  - description: дата окончания
  
При наличии ошибки передается поле errorCode и errorMessage с описанием ошибки.

### Сценарий 2: Проверка валидности любого токена

Вызывается метод GET /sec/st/checkToken, на вход передается:

- ctn: необязательный параметр
- token: проверяемый токен

Если было передано ctn в шаге 1.a, бекенд вызывает метод GET /core/sr/checkAuthToken микросервиса Система регистрации, на вход передаются параметры:

- ctn: номер телефона
- token: токен авторизации

Если получен ответ success, то бекенд переходит к шагу 4.

Бекенд обращается к таблице systemToken (база данных), проверяет наличие токена из шага 1.b в таблице.

- Если в таблице не найден токен - сценарий завершается ошибкой TOKEN_NOT_FOUND.
- Если в таблице найден токен - сценарий продолжается.

Бекенд формирует ответ:

- status: success или error

При наличии ошибки передается поле errorCode и errorMessage с описанием ошибки.

## База данных

### Таблица systemToken

| Поле         | Описание                     |
|--------------|------------------------------|
| systemToken  | Токен                        |
| startDate    | Дата начала действия токена |
| endDate      | Дата окончания               |
| description  | Описание                     |
| system       | Система потребитель          |

## Ошибки

| Код ошибки       | Сообщение передаваемое на фронт |
|------------------|---------------------------------|
| TOKEN_NOT_FOUND  | Токен не найден                  |
